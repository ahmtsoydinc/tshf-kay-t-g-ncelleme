<!DOCTYPE html>
<html lang="tr">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>TSHF | Kayƒ±t G√ºncelleme Paneli</title>
<style>
body {
  background: linear-gradient(135deg, #007bff, #00c6ff);
  font-family: 'Segoe UI', sans-serif;
  color: #fff;
  margin: 0;
  padding: 0;
}
.container {
  max-width: 650px;
  margin: 60px auto;
  backdrop-filter: blur(15px);
  -webkit-backdrop-filter: blur(15px);
  background: rgba(255,255,255,0.2);
  border-radius: 20px;
  padding: 30px;
  box-shadow: 0 8px 32px rgba(0,0,0,0.3);
  text-align: center;
}
h2 {
  text-shadow: 0 2px 5px rgba(0,0,0,0.4);
  margin-bottom: 20px;
}
label {
  display: block;
  text-align: left;
  font-weight: 600;
  margin-top: 15px;
}
select, input {
  width: 100%;
  padding: 10px;
  margin-top: 6px;
  border-radius: 10px;
  border: none;
  font-size: 15px;
  background: rgba(255,255,255,0.9);
}
button {
  width: 100%;
  margin-top: 20px;
  padding: 12px;
  border: none;
  border-radius: 10px;
  background: linear-gradient(135deg, #007bff, #0056b3);
  color: #fff;
  font-size: 16px;
  cursor: pointer;
  transition: all 0.3s ease;
}
button:hover { background: linear-gradient(135deg, #0056b3, #003d80); }
.table-container {
  overflow-x: auto;
  margin-top: 25px;
  background: rgba(255,255,255,0.15);
  border-radius: 12px;
}
table {
  width: 100%;
  border-collapse: collapse;
  color: #fff;
  font-size: 14px;
}
th {
  background: rgba(0,0,0,0.4);
  padding: 10px;
}
td {
  padding: 8px;
  border-bottom: 1px solid rgba(255,255,255,0.2);
}
.edit-btn {
  background: #28a745;
  border: none;
  color: white;
  padding: 5px 8px;
  border-radius: 5px;
  cursor: pointer;
}
.modal {
  position: fixed;
  inset: 0;
  background: rgba(0,0,0,0.6);
  display: flex;
  align-items: center;
  justify-content: center;
  z-index: 9999;
}
.modal-content {
  background: rgba(255,255,255,0.9);
  padding: 20px;
  border-radius: 12px;
  width: 90%;
  max-width: 400px;
  color: #333;
}
.modal-buttons {
  display: flex;
  justify-content: space-between;
}
@media (max-width: 600px) {
  .container { margin: 25px; padding: 20px; }
  h2 { font-size: 1.3rem; }
}
</style>
</head>
<body>
<div class="container">
  <h2>ü™∂ T√ºrkiye S√ºs Tavuklarƒ± Federasyonu<br>Kayƒ±t G√ºncelleme Paneli</h2>

  <label for="dernekSelect">Dernek Se√ß:</label>
  <select id="dernekSelect">
    <option>Dernek listesi y√ºkleniyor...</option>
  </select>

  <label for="adInput">Ad Soyad:</label>
  <input id="adInput" placeholder="Ad ve Soyad giriniz..." type="text" />

  <button id="listeleBtn">Kayƒ±tlarƒ± Listele</button>

  <div class="results"></div>

  <p style="margin-top:25px;font-size:13px;color:rgba(255,255,255,0.8);">
    ¬© 2025 T√ºrkiye S√ºs Tavuklarƒ± Federasyonu<br>
    <span style="font-size:12px;">Kayƒ±t Y√∂netim Sistemi</span>
  </p>
</div>

<script>
const API_URL = "https://script.google.com/macros/s/AKfycbye0QhSU6VNyORVhPe-gNHcBI_Tp2jhz_w8lj8R4PjBMuUPqfDJNoHTXpzQovQhcmUsCA/exec";

async function loadDernekler() {
  try {
    const res = await fetch(API_URL + "?action=dernekler");
    const data = await res.json();
    const select = document.getElementById("dernekSelect");
    select.innerHTML = '<option value="">Dernek Se√ß...</option>';
    data.forEach(d => {
      const opt = document.createElement("option");
      opt.value = d; opt.textContent = d; select.appendChild(opt);
    });
  } catch {
    document.getElementById("dernekSelect").innerHTML = "<option>‚ùå Dernek listesi y√ºklenemedi</option>";
  }
}

async function getRecords() {
  const dernek = document.getElementById("dernekSelect").value;
  const ad = document.getElementById("adInput").value.trim();
  if (!dernek || !ad) return alert("‚ö†Ô∏è L√ºtfen dernek se√ßip ad soyad giriniz!");
  const res = await fetch(`${API_URL}?action=get&dernek=${encodeURIComponent(dernek)}&ad=${encodeURIComponent(ad)}`);
  const data = await res.json();
  window.lastData = data;
  if (!data.length) {
    document.querySelector(".results").innerHTML = "<p style='color:yellow;text-align:center;'>‚ùå Kayƒ±t bulunamadƒ±.</p>";
    return;
  }
  renderTable(data);
}

function renderTable(data) {
  const tableContainer = document.createElement("div");
  tableContainer.className = "table-container";
  tableContainer.innerHTML = `
    <table>
      <thead>
        <tr><th>Tarih</th><th>Ad Soyad</th><th>Irk</th><th>Cins</th><th>Renk</th><th>Bilezik</th><th>ƒ∞≈ülem</th></tr>
      </thead>
      <tbody>
        ${data.map((r,i)=>`
          <tr>
            <td>${r.kayitTarihi}</td>
            <td>${r.adSoyad}</td>
            <td>${r.irk}</td>
            <td>${r.cins}</td>
            <td>${r.renk}</td>
            <td>${r.bilezik}</td>
            <td><button class="edit-btn" onclick="editRecord(${i})">üñã</button></td>
          </tr>`).join('')}
      </tbody>
    </table>`;
  document.querySelector(".results").innerHTML = "";
  document.querySelector(".results").appendChild(tableContainer);
}

function editRecord(i) {
  const row = window.lastData[i];
  const modal = document.createElement("div");
  modal.className = "modal";
  modal.innerHTML = `
    <div class="modal-content">
      <h3>Kayƒ±t G√ºncelle</h3>
      <label>Ad Soyad:</label><input id="editAd" value="${row.adSoyad}">
      <label>Cins:</label><input id="editCins" value="${row.cins}">
      <label>Renk:</label><input id="editRenk" value="${row.renk}">
      <label>Bilezik:</label><input id="editBilezik" value="${row.bilezik}">
      <div class="modal-buttons">
        <button onclick="saveEdit(${i})">Kaydet</button>
        <button onclick="document.querySelector('.modal').remove()">Kapat</button>
      </div>
    </div>`;
  document.body.appendChild(modal);
}

async function saveEdit(i) {
  const updated = {
    action: "update",
    row: i + 1,
    adSoyad: document.getElementById("editAd").value,
    cins: document.getElementById("editCins").value,
    renk: document.getElementById("editRenk").value,
    bilezik: document.getElementById("editBilezik").value,
  };
  const res = await fetch(API_URL, { method: "POST", body: JSON.stringify(updated) });
  const text = await res.text();
  if (text === "OK") {
    alert("‚úÖ Kayƒ±t g√ºncellendi!");
    document.querySelector(".modal").remove();
    getRecords();
  } else alert("‚ùå Hata: " + text);
}

document.getElementById("listeleBtn").addEventListener("click", getRecords);
loadDernekler();
</script>
</body>
</html>
